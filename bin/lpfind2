#!/bin/bash

n=y
while getopts c:f: option; do
    n=n
    case "${option}" in
        c) CLASSNAME=${OPTARG} ;;
        f) FIELDNAME=${OPTARG} ;;
    esac
done

LOC=$(pwd); cd /
ODOODIR="/usr/share/" # TODO: *odoo* | OCB

# >>> -n: SEARCH MODULE NAME (default)
if [[ $n == y ]]; then
    SEARCH="$1"
    echo -e "SEARCHING FOR\t\t$SEARCH"
    echo -e "IN DIRECTORY\t\t$ODOODIR"

    echo -e "\nORIGIN"
    grep -Rns --include=*py " _name.\?=.\?\(\\\"\|'\)$SEARCH\(\\\"\|'\)" $ODOODIR
    echo -e "\nINHERITANCES"
    grep -Rns --include=*py " _inherit.\?=.\?\(\\\"\|'\)$SEARCH\(\\\"\|'\)" $ODOODIR
    exit 0
fi

# >>> -c: SEARCH CLASS NAME
if [[ $c == y && $f == y ]]; then
    matches_class=$(grep -Rns --include=*py " class $CLASSNAME\(" $ODOODIR)
    # for each file in this list, grep after all "class"-instances and save the line number
    # of the first class after the match.
    # This way we can know if a field is in or outside of the class

    # when inside the above for loop, grep after the field:
    matches_field=$(grep -Rns --include=*py " $FIELDNAME.\?=.\?" $ODOODIR)
fi

# >>> -c: SEARCH CLASS NAME
elif [[ $c == y ]]; then
    grep -Rns --include=*py " class $CLASSNAME\(" $ODOODIR
fi

# >>> -f: SEARCH CLASS NAME
elif [[ $f == y ]]; then
    grep -Rns --include=*py " $FIELDNAME.\?=.\?" $ODOODIR
fi

cd $LOC
